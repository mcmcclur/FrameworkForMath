# TeX Overlays

If you'd like to adorn your Plot with LaTeX labels, there are a couple of ways to go. This page illustrates how to overlay labels on top of your plot.

## The setup

In this approach, we place our plot within a relatively positioned DIV and overlay an absolutely positioned DIV on top of that with LaTeX typesetting generated by MathJax, KaTeX, or (easiest) the TeX macro. The general structure looks like so:

    <div class="container" style="position: relative">
      <svg> <!-- Generated by Plot --> </svg>
      <div class="overlay" style="position: absolute">
        <!-- Content generated by TeX Macro -->
      </div>
    </div>

The overlay can be positioned using its `left` and `right` styles. Setting the location precisely can be tricky. Note, though, that a plot generated by Observable.Plot exposes a `scale` method that let's you translate from your mathematical coordinates to the image coordinates to ease this process. It also seems to be important to set the dimensions of the container and the plot to agree with one another and it's often convenient to do so using Framework's `width` reactive variable.

## Interactive example

Here's an interactive plot of the family of normal distributions parameterized by mean ${tex`\mu`} and standard devation ${tex`\sigma`} with those values indicated on top of the plot. The effect is very much like [this example implemented with unicode](../Plot/#unicode) but, I think, somewhat nicer.

<div class="collapse card">

```js
const m = view(Inputs.range([-2,2],
  { label: tex`\mu:`, value: 0, step: 0.01 }))
```
```js
const s = view(Inputs.range([0.2,1.8],
  { label: tex`\sigma:`, value: 1, step: 0.01 }))
```

```js echo
// // Dependent on the following Input.range elements:
// const m = view(Inputs.range([-2,2],
//   { label: tex`\mu:`, value: 0, step: 0.01 }));
// const s = view(Inputs.range([0.2,1.8],
//   { label: tex`\sigma:`, value: 1, step: 0.01 }));


// Set up the size of the image.
let w = d3.min([width, 900]);
let h = 0.4 * w;

let container = d3.create('div')
  .style('position', 'relative')
  .style('width', `${w}px`)
  .style('height', `${h}px`);

const f = x => Math.exp((-((x-m)**2)/(2*s**2)))/(Math.sqrt(2*Math.PI)*s)
const pts = d3.range(-3.2,3.2,0.01).map(x => [x,f(x)]);
const plot = Plot.plot({
  margin: 30,
  width: w,
  height: h,
  y: {domain: [-0.05,1.55]},
  marks: [
    Plot.line(pts, {strokeWidth: 3}),
    Plot.ruleY([0]),
    Plot.axisX({y:0}),
    Plot.ruleX([0]),
    Plot.axisY({x:0, ticks: 5})
  ]
});
const x_scale = plot.scale("x");
const y_scale = plot.scale("y");
container.append(() => plot);

const labels = container.append('div')
  .style('position', 'absolute')
  .style('background', 'rgba(255,255,255,0.7)')
  .style('left', `${x_scale.apply(m)-20}px`)
  .style('bottom', `${h-y_scale.apply(f(m))+8}px`)

labels.append(() => html`<div>${tex`\mu = ${m}`}</div>`);
labels.append(() => html`<div>${tex`\sigma = ${s}`}</div>`);

display(container.node())
```

</div>

## Tick labels

[unicode tick labels](../Plot/#unicode_tick_labels)

<div class="card collapse">

```js echo
// We're going to plot a graph of the sine function
// and we'd like the tick marks expressed in terms of pi.
const f = (x) => Math.sin(x);

// Set up the size of the image.
let w = d3.min([width, 900]);
let h = 0.3 * w;

// Set up a container for the image.
// The container has the *relative* position
// so that we can place texed tickmarks in
// absolutely positioned DIVs.
let container = d3
  .create("div")
  .style("position", "relative")
  .style("width", `${w}px`)
  .style("height", `${h}px`);

// The points to plot.
let dx = 0.01;
let pts = d3.range(-10, 10 + dx, dx).map((x) => [x, f(x)]);

// We'll use  Observable Plot to generate the graph.
// Store the result in a variable, since we'll modify
// it a bit.
let plot = Plot.plot({
  margin: 30,
  width: w,
  height: h,
  y: { domain: [-1.1, 1.1] },
  marks: [
    Plot.line(pts),
    Plot.axisX({
      y: 0,
      ticks: d3.range(-3 * Math.PI, 3 * Math.PI + dx, Math.PI),
      tickFormat: () => null
    }),
    Plot.ruleY([0]),
    Plot.axisY({
      x: 0,
      ticks: [-1, 1],
      tickFormat: () => null
    }),
    Plot.ruleX([0])
  ]
});

// Plot the plot in the container.
container.append(() => plot);

// Observable Plot exposes scales that makes it
// easy to place stuff correctly in the plot.
let x_scale = plot.scale("x");
let y_scale = plot.scale("y");

// Add x-tick labels. Each label is contained in
// an absolutely positioned DIV whose left style
// is determined by the tick value.
container
  .selectAll(null)
  .data(d3.range(-3, 3.1, 1))
  .join("div")
  .attr("class", "x-tick-label")
  .style("position", "absolute")
  .style("left", (n) =>
    `${x_scale.apply(n * Math.PI) - (n < 0 ? 20 : n==1 ? 8 : 12)}px`)
  .style("top", `${y_scale.apply(0) + 2}px`)
  .style("padding", "2px")

  // append the label; the code for the label function
  // is defined below and returns a tex macro that looks
  // something like tex`${n}\pi`
  .append(label);

// Add y-tick labels as well for consistency.
container
  .selectAll(null)
  .data([-1, 1])
  .join("div")
  .attr("class", "y-tick-label")
  .style("position", "absolute")
  .style("right", `${x_scale.apply(0) + 5}px`)
  .style("top", (n) => `${y_scale.apply(n) - 16}px`)
  .style("padding", "2px")
  .append((n) => tex`\footnotesize ${n}`);

display(container.node());


function label(n) {
  if (Math.abs(n) > 1) {
    return tex`\footnotesize ${n}\pi`;
  } else if (n == -1) {
    return tex`\footnotesize -\pi`;
  } else if (n == 1) {
    return tex`\footnotesize \pi`;
  } else {
    return tex` `;
  }
}
```

</div>

```js
import {build_samples} from
  '../../common_components/build_samples.js';
import {collapse_code} from '../../common_components/collapse_code.js'
collapse_code()
```
